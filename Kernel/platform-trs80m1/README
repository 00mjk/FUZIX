TRS80 Model I and III

This port supports the following configurations currently

	TRS80 model I with Alpha SuperMem (or compatibles), 256K+ recommended
	Options:
		Floppy Disk (somewhat basic support, no format tool yet)
		Hard Disk (Tandy compatible)
		Lower Case Kit (Optional, either Tandy or the simple mods)
		Percom Compatible Doubler
		Holmes style speed up board (anything using port 254 bit 0)
		Real Time Clock (supported for time locking, can't do dates as
				 is not Y2K capable)
		HRG1B Graphics Card
		Alpha Products Joystick
		ChromaTRS (as jostick and a graphics device only - need a VDP
			emulation in xtrs to do console support)

	In Progress:
		Exatron stringy

	Planned:
		Orchestra 80 sound card

	TRS80 model III with Alpha SuperMem (or compatibles), 256K+ recommended
	Options:
		Hard Disk (Tandy compatible, so not afaik MIOSYS)
		Holmes speed up board (using port 95)
		Real Time Clock (supported for time locking, can't do dates as
				 is not Y2K capable)
		Micro Labs Graphyx
		Tandy Hi-Res Card
		Alpha Products Joystick
		ChromaTRS (as jostick and a graphics device only - need a VDP
			emulation in xtrs to do console support)

	Planned:
		Orchestra 90 sound card
		Lo-tech IDE adapter

Under Investigation:

	Video Genie I/II with banked memory (eg via S100)
	LNW80 with banked memory (selector and similar)



Not Supported:
	Lubomir Soft Banker	-	only provides 96K RAM (not enough
					for this build)
	Various 64K only CP/M adapters

Would Be Nice:
	80-Grafix		-	need docs, example apps to debug
					an emulator


Emulator Bugs:
	Repeating instructions like LDIR appear to be misemulated. LDIR
	is performed as an emulated block copy, not as an iterated LDI. The
	real processor actually implements LDIR as  "LDI, if not done
	PC -= 2". FUZIX doesn't do any overlapped LDIR tricks so shouldn't
	be affected.

	The interrupt flags are misemulated and RETI is also wrong.

	Use the xtrs in the EtchedPixels github which fixes the ones that
	matter.

User Space:
	The TRS80 Model I/III have ROM in the low 16K. At the moment our
	binaries are not relocatable so you need to build a custom user
	space for this platform.

Requirements: 
	TRS80 Model I or III (or emulator)
	Preferably the lower case mod
	Supermem or compatible expansion
	Floppy drive or Hard drive (strongly recommend the latter)

Optional:
	Lower case modification

To Do:
	Other banked expansions
	Hires card
	Stringy floppy (Model 1 looks easy but needs ROM image)
	Orchestra
	Graphics hooks (both hires and also describe 64x16 lo-res pixel blocks)
	Look at RTS/CTS flow control
	- Needs tty sleeping support
	- Needs to deal with model 1 case where it's polled so we need
	  to check the flow control on timer ticks if needed
	Fast block copy routines for uget/uput
	Hint based pre-fetching uget
	Consider moving the tty buffers into banked space (INDIRECT_QUEUE)

Memory Map:
	0000-3FFF	Various fixed model 1 functionality
	4000-41FF	Kept clear for ROM bits
	4200-7FFF	Kernel data, common etc
	8000-FFFF	Bank0: kernel code
	8000-FFFF	Bank1: kernel code

	Remaining banks of 32K are user apps.

	The kernel doesn't actually need 80K but it also doesn't fit in
	the available 48K unbanked either (although a minimalish setup might)

	Need to move buffers out of line using the external buffers code so we
	can better balance memory

Drivers:
	Display 64x16			Done
	Keyboard			Done
	Hard drive			Straight model 4 port
	Floppy				Minimal at this point
	Floppy drivers do not yet deal with double sided disks or sd/dd
	media detection
	Hard disk reads block 0, and handle partitions of some form
	including finding where 'swap' lives (swap not tested)

Setting It Up (current xtrs: https://github.com/TimothyPMann/xtrs with patches)

	make
	cp boot.jv3  /whereever/disk1-0
	xtrs -model 1 -emtsafe --supermem

To set up for hard disk, create a hard disk with the xtrs tools and

	mkdisk -h hard1-0
	# This assumes the default disk size
	cd Standalone/filesystem-src
	./build-filesystem trs80.hd 256 21760
	dd if=trs80.hd of=hard1-0 bs=256 seek=1 conv=notrunc
	tools/trslabel hard1-0
	#
	xtrs -model 1 -emtsafe -supermem


You will still need a boot floppy at this point but just boot with device
0 (or hit return). Swap is configured to be on the end of the hard disk



Banking Models

Currently Supported:
	Alpha Technology Supermem upper 32K banking only.

Not Yet Started:
	"Selector" for Model 1. Port 31 allows memory reshuffling away from
the model 1 default. Either the upper or lower 32K is switchable but not
both at once. bits 4/5 control the selection between a further 4 32K banks.
Really selector is its own port.

Useful rom addresses(Model I) 

04C3 -> 64 column
04F6 -> 32 column

0060 -> 14.5*BC uS delay @ 1.774MHz


Floppy boot requires a single density disk. The Level II ROM reads
disk 0 side 0 track 0 sector 0 (TRS80 disks are 0 offset sector count)
into 4200-42FF and then does a JP 4200	(stack is around 407D)

Floppy boot for a model III is similar but double density to 4300
